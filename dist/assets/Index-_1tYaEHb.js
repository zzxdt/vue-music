import{Q as S,G as V,Y as $,R as B,r as E,e as M,o as P,w as C,J as R,j as r,k as n,l as o,F as T,C as b,X as L,D as m,z as w,s as u,y as D,v as I,m as j,q,a0 as z,U as F,V as G}from"./index-nvWmsnf9.js";import{E as J}from"./el-infinite-scroll-ZIv0e9pO.js";import{_ as x}from"./Loading-KSf3ufRB.js";import{_ as N}from"./PlayList-_u7cpBFH.js";import"./throttle-IPVAgrZU.js";import"./el-skeleton-item-kIwtNASk.js";const Q={name:"PlayListWrap",setup(){const{proxy:s}=V(),c=$(),y=B(),l=c.query.cat,t=E({sub:[],categories:[],curType:"全部歌单",moreTxt:{},allList:{name:"全部歌单"},playlist_list:[],playlist_count:24,playlist_loading:!0,busy:!0,params:{order:"hot",cat:l,limit:48,offset:0}}),f=async()=>{const{data:e}=await s.$http.catlist();if(t.sub=e.sub,e.code!==200)return s.$msg.error("数据请求失败");for(const a in e.categories){const d={name:e.categories[a]};d.children=t.sub.filter(k=>k.category===Number(a)),t.categories.push(d)}t.curType=l||e.all.name,t.allList=e.all,_()},_=()=>{const e=t.sub.find(a=>a.name===t.curType);t.moreTxt={},e&&t.categories[e.category].children.indexOf(e)>=8&&(t.moreTxt[e.category]=e)};M(()=>()=>["item-box","filter-more",moreTxt[index]?"active":""]);const h=e=>{y.push({path:"playlist",query:{cat:e.name,order:t.params.order}})},g=()=>{y.push({path:"playlist"})},v=e=>{y.push({path:"playlist",query:{cat:t.params.cat,order:e}})},i=async e=>{const{data:a}=await s.$http.playList(e);if(a.code!==200)return s.$msg.error("数据请求失败");t.playlist_list=t.params.offset!==0?[...t.playlist_list,...a.playlists]:a.playlists,t.busy=t.playlist_list.length>=a.total,t.playlist_loading=!1},p=()=>{t.busy=!0,t.params.offset=t.playlist_list.length};return P(()=>{f(),i(t.params)}),C(()=>c.query,(e,a)=>{const{cat:d,order:k}=e;t.curType=d||t.allList.name,t.params=Object.assign({},{order:"hot",cat:"",limit:50,offset:0},{cat:d||"",order:k||"hot"}),_()}),C(()=>t.params,(e,a)=>{e.cat!==a.cat&&(t.busy=!0,t.playlist_list=[]),i(e)},{deep:!0}),{...R(t),getCatlist:f,selectType:h,closed:g,loadMore:p,selectOrder:v}},components:{PlayList:N,Loading:x}},O=s=>(F("data-v-7484ad3e"),s=s(),G(),s),U={class:"playlist"},W={class:"filter"},X={class:"filter-title"},Y={class:"filter-box"},A=["onClick"],H=O(()=>o("i",{class:"iconfont icon-arrow"},null,-1)),K={key:1},Z={class:"filter-drop"},ee=["onClick"],te={class:"list-container"},se={class:"list-head"},ae=O(()=>o("i",{class:"iconfont icon-closed"},null,-1)),oe=[ae],re={class:"type"},le={class:"wrapper infinite-list","infinite-scroll-disabled":"busy","infinite-scroll-distance":"100"};function ie(s,c,y,l,t,f){const _=z,h=N,g=x,v=J;return r(),n("div",U,[o("div",W,[(r(!0),n(T,null,b(s.categories,(i,p)=>(r(),n("div",{class:"filter-item",key:p},[o("div",X,m(i.name),1),o("div",Y,[(r(!0),n(T,null,b(i.children.slice(0,8),e=>(r(),n("span",{class:u(["item-box",s.curType===e.name?"active":""]),key:e.name},[o("em",{onClick:a=>l.selectType(e)},m(e.name),9,A)],2))),128)),I(_,{width:"auto",trigger:"click"},{reference:q(()=>[i.children.length>9?(r(),n("span",{key:0,class:u(["item-box","filter-more",s.moreTxt[p]?"active":""])},[o("em",null,[L(m(s.moreTxt[p]?s.curType:"更多"),1),H])],2)):(r(),n("span",K))]),default:q(()=>[o("div",Z,[(r(!0),n(T,null,b(i.children.slice(9),e=>(r(),n("span",{class:u(["item-box",s.curType===e.name?"active":""]),key:e.name},[o("em",{onClick:a=>l.selectType(e,p)},m(e.name),9,ee)],2))),128))])]),_:2},1024)])]))),128))]),o("div",te,[o("div",se,[o("h2",null,[L(m(s.curType)+" ",1),s.curType!==s.allList.name?(r(),n("em",{key:0,class:"filter-close",onClick:c[0]||(c[0]=(...i)=>l.closed&&l.closed(...i))},oe)):w("",!0)]),o("div",re,[o("span",{class:u(s.params.order==="hot"?"active":""),onClick:c[1]||(c[1]=i=>l.selectOrder("hot"))},"热门",2),o("span",{class:u(s.params.order==="new"?"active":""),onClick:c[2]||(c[2]=i=>l.selectOrder("new"))},"最新",2)])]),D((r(),n("div",le,[I(h,{playList:s.playlist_list,loading:s.playlist_loading,num:s.playlist_count},null,8,["playList","loading","num"]),s.busy?(r(),j(g,{key:0})):w("",!0)])),[[v,l.loadMore]])])])}const ye=S(Q,[["render",ie],["__scopeId","data-v-7484ad3e"]]);export{ye as default};
