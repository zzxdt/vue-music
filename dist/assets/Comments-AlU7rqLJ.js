import{Q as M,r as V,w as B,J as D,j as r,k as i,l as s,D as m,y as E,ah as N,X as p,v as d,q as u,ai as T,G as j,W as z,e as x,o as P,i as R,z as b,F as w,C as S,s as G,m as O,T as Q,S as W,aj as X,ak as A,U as K,V as Y}from"./index-nvWmsnf9.js";const Z={name:"replyComment",props:["params"],setup(t,{emit:c}){const a=V({msg:"",maxLen:140}),e=()=>{c("replyMsg",a.msg)};return B(()=>a.msg,()=>{a.msg=a.maxLen>=a.msg?a.msg:a.msg.substring(0,a.maxLen)}),{...D(a),subReplyComment:e}}},ee={class:"reply-comment"},se={class:"comment_textarea"},te={class:"pre"},oe={class:"comment_box_footer"},ne={class:"comment_limit"},ae={class:"num"};function ce(t,c,a,e,L,h){const y=T;return r(),i("div",ee,[s("h3",null,"我回复@"+m(a.params.user.nickname)+":",1),s("div",se,[s("div",te,m(t.msg),1),E(s("textarea",{class:"J_inpBox inp-paragraph",name:"leave_msg",id:"leave_msg",placeholder:"期待你的神评论……","onUpdate:modelValue":c[0]||(c[0]=g=>t.msg=g)},null,512),[[N,t.msg]])]),s("div",oe,[s("span",ne,[s("em",ae,m(t.msg.length),1),p("/"+m(t.maxLen),1)]),d(y,{type:"primary",color:"#ff641e",onClick:e.subReplyComment},{default:u(()=>[p("评论")]),_:1},8,["onClick"])])])}const me=M(Z,[["render",ce],["__scopeId","data-v-5e6afbb7"]]),le={name:"Comments",components:{ReplyComment:me},props:{sId:{type:[Number,String],default:0},type:{type:Number,default:0}},setup(t){const{proxy:c}=j(),a=z(),e=V({msg:"",maxLen:140,curId:t.sId,limit:20,offset:0,before:0,hotComments:[],comments:[],total:0,currentPage:0,isEmpty:!1,replyCommentId:0,replyIndex:-1}),L=x(()=>a.getters.userInfo),h=x(()=>a.getters.isLogin),y=x(()=>function(o,l){return o.commentId===e.replyCommentId&&e.replyIndex===l}),g=()=>{switch(t.type){case 0:C("commentSong");break;case 1:C("commentMv");break;case 3:C("albumComment");break;case 5:C("commentVideo");break}},C=async o=>{const{data:l}=await c.$http[o]({id:e.curId,limit:e.limit,offset:e.offset,before:e.before,timestamp:new Date().valueOf()});v(l)},v=o=>{if(o.code!==200)return c.$msg.error("数据请求失败");e.total=o.total,e.hotComments=o.hotComments||[],e.hotComments.map(l=>(l.isHot=!0,l)),e.comments=[...e.hotComments,...o.comments],e.isEmpty=e.before===0&&!e.comments.length},I=async(o,l,q)=>{const F={t:o,type:t.type,id:e.curId,content:l,commentId:q},{data:J}=await c.$http.comment(F);if(J.code!==200)return c.$msg.error("数据请求失败");e.msg="",g(),o===0?c.$msg.success("删除评论成功！"):o===1?c.$msg.success("评论成功！"):o===2&&(c.$msg.success("回复评论成功！"),e.replyCommentId=0,e.replyIndex=-1)},$=async()=>{if(!h.value){a.commit("setLoginDialog",!0);return}I(1,e.msg)},n=o=>{c.$msgBox.confirm("确定删除评论？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",center:!0}).then(()=>{I(0,"",o.commentId)}).catch(()=>{})},k=(o,l)=>{if(!h.value){a.commit("setLoginDialog",!0);return}e.replyCommentId=e.replyCommentId===o.commentId&&e.replyIndex===l?0:o.commentId,e.replyIndex=l},_=o=>{if(!h.value){a.commit("setLoginDialog",!0);return}I(2,o,e.replyCommentId)},H=async o=>{if(!h.value){a.commit("setLoginDialog",!0);return}const{data:l}=await c.$http.commentLike({id:e.curId,cid:o.commentId,t:+!o.liked,type:t.type});if(l.code!==200)return c.$msg.error("数据请求失败");g()},U=o=>{e.offset=(o-1)*e.limit};return P(()=>{g()}),B(()=>t.sId,(o,l)=>{e.curId=o,e.offset=0,g()}),B(()=>e.msg,()=>{e.msg=e.maxLen>=e.msg?e.msg:e.msg.substring(0,e.maxLen)}),{...D(e),userInfo:L,isLogin:h,subComment:$,delComment:n,replyMsg:_,replyComment:k,likeComment:H,isShowReply:y,currentChange:U}}},f=t=>(K("data-v-5afbccec"),t=t(),Y(),t),re={class:"comments"},ie={class:"comment_hd"},de={key:0,class:"userInfo"},_e=f(()=>s("div",{slot:"placeholder",class:"image-slot"},[s("i",{class:"iconfont icon-placeholder"})],-1)),ue={class:"comment_textarea"},pe={class:"pre"},ge={class:"comment_box_footer"},fe={class:"comment_limit"},he={class:"num"},ye={class:"comment_area"},Ce=f(()=>s("div",{slot:"placeholder",class:"image-slot"},[s("i",{class:"iconfont icon-placeholder"})],-1)),ve={class:"comment_info"},Ie={class:"comment_content"},ke={class:"comment_footer"},be={class:"comment_time"},Le={class:"comment_oper"},$e=["onClick"],xe=f(()=>s("i",{class:"iconfont icon-del"},null,-1)),we=[xe],Be=["onClick"],Re=f(()=>s("i",{class:"iconfont icon-praise"},null,-1)),Se=["onClick"],Me=f(()=>s("i",{class:"iconfont icon-comment"},null,-1)),Ve=[Me],De={key:0,class:"isHot"},Ee=f(()=>s("i",{class:"iconfont icon-choicest"},null,-1)),Ne=[Ee],Te={class:"pagination"},He={key:1,class:"comments_status"},Ue={key:0,class:"loading"},qe={key:1,class:"empty"},Fe=f(()=>s("p",null,[s("i",{class:"iconfont icon-empty-main"})],-1)),Je=f(()=>s("p",null,"暂无留言",-1)),je=[Fe,Je];function ze(t,c,a,e,L,h){const y=W,g=T,C=X,v=R("router-link"),I=R("reply-comment"),$=A;return r(),i("div",re,[s("div",ie,[s("h2",null,[p("评论"),s("em",null,"共"+m(t.total)+"条评论",1)]),e.userInfo?(r(),i("div",de,[s("span",null,m(e.userInfo.nickname),1),d(y,{src:e.userInfo.avatarUrl,class:"avatar"},{default:u(()=>[_e]),_:1},8,["src"])])):b("",!0)]),d(C,{class:"comment_box"},{default:u(()=>[s("div",ue,[s("div",pe,m(t.msg),1),E(s("textarea",{class:"J_inpBox inp-paragraph",name:"leave_msg",id:"leave_msg",placeholder:"期待你的神评论……","onUpdate:modelValue":c[0]||(c[0]=n=>t.msg=n)},null,512),[[N,t.msg]])]),s("div",ge,[d(g,{type:"primary",color:"#ff641e",onClick:e.subComment},{default:u(()=>[p("评论")]),_:1},8,["onClick"]),s("span",fe,[s("em",he,m(t.msg.length),1),p("/"+m(t.maxLen),1)])])]),_:1}),s("div",ye,[t.comments.length?(r(),i(w,{key:0},[(r(!0),i(w,null,S(t.comments,(n,k)=>(r(),i("div",{class:"comment_item",key:n.commentId+k+""},[d(v,{to:{path:"/user",query:{id:n.user.userId}},class:"comment_avatar"},{default:u(()=>[d(y,{src:n.user.avatarUrl+"?param=120y120"},{default:u(()=>[Ce]),_:2},1032,["src"])]),_:2},1032,["to"]),s("div",ve,[d(v,{to:{path:"/user",query:{id:n.user.userId}}},{default:u(()=>[p(m(n.user.nickname),1)]),_:2},1032,["to"]),s("div",Ie,m(n.content),1),(r(!0),i(w,null,S(n.beReplied,_=>(r(),i("div",{class:"comment_reply",key:_.beRepliedCommentId},[d(v,{to:{path:"/user",query:{id:_.user.userId}}},{default:u(()=>[p(m(_.user.nickname),1)]),_:2},1032,["to"]),p(": "+m(_.content),1)]))),128)),s("div",ke,[s("div",be,m(t.$utils.formatMsgTime(n.time)),1),s("div",Le,[e.userInfo&&e.userInfo.userId===n.user.userId?(r(),i("em",{key:0,class:"comment_del",onClick:_=>e.delComment(n)},we,8,$e)):b("",!0),s("span",{class:G([n.liked?"active":""]),onClick:_=>e.likeComment(n)},[Re,p("("+m(n.likedCount)+")",1)],10,Be),s("span",{class:"replyComment",onClick:_=>e.replyComment(n,k)},Ve,8,Se)])]),n.isHot?(r(),i("div",De,Ne)):b("",!0),d(Q,{name:"fade",mode:"out-in"},{default:u(()=>[e.isShowReply(n,k)?(r(),O(I,{key:0,params:n,onReplyMsg:e.replyMsg},null,8,["params","onReplyMsg"])):b("",!0)]),_:2},1024)])]))),128)),s("div",Te,[d($,{onCurrentChange:e.currentChange,layout:"prev, pager, next",total:t.total},null,8,["onCurrentChange","total"])])],64)):(r(),i("div",He,[t.isEmpty?(r(),i("div",qe,je)):(r(),i("div",Ue,"评论加载中..."))]))])])}const Ge=M(le,[["render",ze],["__scopeId","data-v-5afbccec"]]);export{Ge as C};
